#!/bin/bash

if [ -x /usr/bin/vim ]; then
    VIM=/usr/bin/vim
fi

if [ -x /usr/local/bin/vim ]; then
    VIM=/usr/local/bin/vim
fi

if [ ! -n "$DISPLAY" ]; then
    exec $VIM "${@}"
else
    exec $VIM --serverlist | grep -qF VIM
    if [ $? -eq 0 ]; then
        WORKSPACE=$(i3-msg -t get_workspaces | sed 's/},{/\n/g' |
            grep '"visible":true' | cut -d: -f3 | cut -d, -f1)
        i3-msg 'workspace 2' &> /dev/null
        $VIM --remote-tab-wait-silent "${@}"
        i3-msg 'workspace '$WORKSPACE &> /dev/null
    else
        exec $VIM "${@}"
    fi
fi
